<div class="dashboard-container">
  <!-- Header with refresh button -->

  <!-- Loading overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-container" *ngIf="!isLoading">
    <mat-card class="stats-card">
      <mat-card-content>
        <div class="stats-icon customers">
          <mat-icon>people</mat-icon>
        </div>
        <div class="stats-info">
          <h3>Total Customers</h3>
          <p class="stats-number">{{ businessStats.totalCustomers }}</p>
          <p class="stats-subtitle">Registered users</p>
        </div>
        <mat-spinner
          diameter="20"
          *ngIf="isLoadingStats"
          class="stats-spinner"
        ></mat-spinner>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card">
      <mat-card-content>
        <div class="stats-icon bookings">
          <mat-icon>calendar_today</mat-icon>
        </div>
        <div class="stats-info">
          <h3>Total Bookings</h3>
          <p class="stats-number">{{ businessStats.totalBookings }}</p>
          <p class="stats-subtitle">All time bookings</p>
        </div>
        <mat-spinner
          diameter="20"
          *ngIf="isLoadingStats"
          class="stats-spinner"
        ></mat-spinner>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card">
      <mat-card-content>
        <div class="stats-icon employees">
          <mat-icon>badge</mat-icon>
        </div>
        <div class="stats-info">
          <h3>Total Employees</h3>
          <p class="stats-number">{{ businessStats.totalEmployees }}</p>
          <p class="stats-subtitle">Active staff</p>
        </div>
        <mat-spinner
          diameter="20"
          *ngIf="isLoadingStats"
          class="stats-spinner"
        ></mat-spinner>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card">
      <mat-card-content>
        <div class="stats-icon completed">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="stats-info">
          <h3>Completed</h3>
          <p class="stats-number">{{ businessStats.completedBookings }}</p>
          <p class="stats-subtitle">Finished bookings</p>
        </div>
        <mat-spinner
          diameter="20"
          *ngIf="isLoadingStats"
          class="stats-spinner"
        ></mat-spinner>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Calendar Section -->
  <mat-card class="calendar-card" *ngIf="!isLoading">
    <div class="calendar-container">
      <!-- Calendar Header -->
      <div class="calendar-header">
        <div class="calendar-month-year">{{ currentMonthYear }}</div>
      </div>

      <!-- Calendar Grid -->
      <div class="calendar-grid">
        <!-- Days of Week Header -->
        <div class="calendar-weekdays">
          <div class="weekday" *ngFor="let day of weekDays">{{ day }}</div>
        </div>

        <!-- Calendar Days -->
        <div class="calendar-days">
          <div
            class="calendar-day"
            *ngFor="let day of calendarDays"
            [class.other-month]="day.isOtherMonth"
            [class.today]="day.isToday"
          >
            <div class="day-number">{{ day.date }}</div>
            <div class="day-events">
              <div
                class="event-label"
                *ngFor="let event of day.events"
                [class]="'event-' + event.type"
              >
                {{ event.label }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-card>

  <!-- Recent Bookings Table -->
  <mat-card class="bookings-card" *ngIf="!isLoading">
    <mat-card-header>
      <mat-card-title>Recent Bookings</mat-card-title>
      <mat-spinner
        diameter="20"
        *ngIf="isLoadingBookings"
        class="bookings-spinner"
      ></mat-spinner>
    </mat-card-header>
    <mat-card-content>
      <div class="table-container" *ngIf="!isLoadingBookings">
        <!-- Desktop Table View -->
        <div class="desktop-table">
          <table mat-table [dataSource]="recentBookings" class="bookings-table">
            <!-- Customer Name Column -->
            <ng-container matColumnDef="customerName">
              <th mat-header-cell *matHeaderCellDef>Customer</th>
              <td mat-cell *matCellDef="let booking">
                {{ booking.customerName }}
              </td>
            </ng-container>

            <!-- Service Column -->
            <ng-container matColumnDef="service">
              <th mat-header-cell *matHeaderCellDef>Service</th>
              <td mat-cell *matCellDef="let booking">{{ booking.service }}</td>
            </ng-container>

            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Amount</th>
              <td mat-cell *matCellDef="let booking">
                {{ formatCurrency(booking.amount) }}
              </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let booking">
                <span
                  class="status-badge"
                  [class]="booking.status.toLowerCase().replace(' ', '-')"
                >
                  {{ displayStatus(booking.status) }}
                </span>
              </td>
            </ng-container>

            <!-- Date Column -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let booking">
                {{ formatDate(booking.date) }}
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let booking">
                <button
                  mat-raised-button
                  color="primary"
                  class="view-details-btn"
                  (click)="viewBookingDetails(booking.id)"
                >
                  <mat-icon>visibility</mat-icon>
                  View Details
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </div>

        <!-- Mobile Card View -->
        <div class="mobile-cards">
          <div class="booking-card" *ngFor="let booking of recentBookings">
            <div class="booking-card-header">
              <div class="customer-info">
                <h4>{{ booking.customerName }}</h4>
                <span class="booking-date">{{ formatDate(booking.date) }}</span>
              </div>
              <span
                class="status-badge"
                [class]="booking.status.toLowerCase().replace(' ', '-')"
              >
                {{ displayStatus(booking.status) }}
              </span>
            </div>
            <div class="booking-card-content">
              <div class="service-info">
                <mat-icon>build</mat-icon>
                <span>{{ booking.service }}</span>
              </div>
              <div class="amount-info">
                <mat-icon>attach_money</mat-icon>
                <span class="amount">{{ formatCurrency(booking.amount) }}</span>
              </div>
            </div>
            <div class="booking-card-actions">
              <button
                mat-raised-button
                color="primary"
                class="view-details-btn mobile-btn"
                (click)="viewBookingDetails(booking.id)"
              >
                <mat-icon>visibility</mat-icon>
                View Details
              </button>
            </div>
          </div>
        </div>

        <!-- Empty state -->
        <div class="empty-state" *ngIf="recentBookings.length === 0">
          <mat-icon>event_busy</mat-icon>
          <h3>No bookings found</h3>
          <p>There are no recent bookings to display.</p>
        </div>
      </div>

      <!-- Loading state for table -->
      <div class="table-loading" *ngIf="isLoadingBookings">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading recent bookings...</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
