<div class="reporting-container">
  <div class="header">
    <h2>Reports & Analytics</h2>
    <div class="header-actions">
      <button
        mat-raised-button
        color="primary"
        [matMenuTriggerFor]="reportMenu"
        class="export-btn"
        [disabled]="isGeneratingPDF"
      >
        <mat-icon>{{
          isGeneratingPDF ? "hourglass_empty" : "picture_as_pdf"
        }}</mat-icon>
        {{ isGeneratingPDF ? "Generating..." : "Export PDF Report" }}
      </button>
      <mat-menu #reportMenu="matMenu">
        <button mat-menu-item (click)="generatePDF('daily')">
          <mat-icon>today</mat-icon>
          <span>Daily Report</span>
        </button>
        <button mat-menu-item (click)="generatePDF('weekly')">
          <mat-icon>date_range</mat-icon>
          <span>Weekly Report</span>
        </button>
        <button mat-menu-item (click)="generatePDF('monthly')">
          <mat-icon>calendar_month</mat-icon>
          <span>Monthly Report</span>
        </button>
        <button mat-menu-item (click)="generatePDF('quantity')">
          <mat-icon>inventory</mat-icon>
          <span>Quantity Report</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- Revenue Cards -->
  <div class="stats-grid">
    <mat-card class="stats-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>calendar_today</mat-icon>
          </div>
          <div class="stat-details">
            <h3>Weekly Revenue</h3>
            <p class="stat-value">₱{{ revenueData.weekly }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>date_range</mat-icon>
          </div>
          <div class="stat-details">
            <h3>Monthly Revenue</h3>
            <p class="stat-value">₱{{ revenueData.monthly }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Monthly Revenue Selector -->
  <div class="revenue-selector-section">
    <mat-card class="revenue-selector-card">
      <mat-card-header>
        <mat-card-title>Select Month Revenue</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="month-revenue-selector">
          <div class="selector-input">
            <label for="revenueMonthPicker">Select Month:</label>
            <input
              id="revenueMonthPicker"
              type="month"
              [(ngModel)]="selectedRevenueMonth"
              (change)="onRevenueMonthChange()"
              class="month-input"
            />
            <span class="date-range">{{ getRevenueMonthDateRange() }}</span>
          </div>
          <div class="revenue-display">
            <div class="revenue-item">
              <div class="revenue-label">Total Revenue</div>
              <div class="revenue-value">
                ₱{{ specificMonthRevenue | number : "1.0-0" }}
              </div>
            </div>
            <div class="revenue-item">
              <div class="revenue-label">Completed Bookings</div>
              <div class="revenue-value">{{ specificMonthBookings }}</div>
            </div>
          </div>
        </div>

        <!-- Weekly Revenue Breakdown Table -->
        <div
          class="weekly-revenue-breakdown"
          *ngIf="weeklyRevenueData.length > 0"
        >
          <h4>Weekly Breakdown</h4>
          <div class="weekly-revenue-table">
            <div class="table-header">
              <div class="table-cell header-cell">Week</div>
              <div class="table-cell header-cell">Start Date</div>
              <div class="table-cell header-cell">End Date</div>
              <div class="table-cell header-cell">Revenue</div>
              <div class="table-cell header-cell">Bookings</div>
            </div>
            <div class="table-rows">
              <div class="table-row" *ngFor="let weekData of weeklyRevenueData">
                <div class="table-cell">Week {{ weekData.week }}</div>
                <div class="table-cell">{{ weekData.startDate }}</div>
                <div class="table-cell">{{ weekData.endDate }}</div>
                <div class="table-cell">
                  ₱{{ weekData.revenue | number : "1.0-0" }}
                </div>
                <div class="table-cell">{{ weekData.bookings }}</div>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Service Statistics -->
  <div class="stats-grid">
    <mat-card class="stats-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>book</mat-icon>
          </div>
          <div class="stat-details">
            <h3>Total Bookings</h3>
            <p class="stat-value">{{ serviceStats.totalBookings }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card success">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-details">
            <h3>Completed Bookings</h3>
            <p class="stat-value">{{ serviceStats.completedBookings }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card warning">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>pending</mat-icon>
          </div>
          <div class="stat-details">
            <h3>Pending Bookings</h3>
            <p class="stat-value">{{ serviceStats.pendingBookings }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card danger">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>cancel</mat-icon>
          </div>
          <div class="stat-details">
            <h3>Cancelled Bookings</h3>
            <p class="stat-value">{{ serviceStats.cancelledBookings }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card info">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>thumb_down</mat-icon>
          </div>
          <div class="stat-details">
            <h3>Declined Bookings</h3>
            <p class="stat-value">{{ serviceStats.declinedBookings }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Section -->
  <mat-tab-group
    class="charts-container"
    (selectedTabChange)="onTabChange($event)"
  >
    <mat-tab label="Revenue Trend">
      <div class="chart-wrapper">
        <canvas id="revenueChart"></canvas>
      </div>
    </mat-tab>

    <mat-tab label="Service Distribution">
      <div class="chart-wrapper">
        <canvas id="serviceChart"></canvas>
      </div>
    </mat-tab>

    <mat-tab label="Weekly Bookings">
      <div class="chart-wrapper">
        <div class="week-selector">
          <label for="weekPicker">Select Week:</label>
          <input
            id="weekPicker"
            type="week"
            [(ngModel)]="selectedWeek"
            (change)="onWeekChange()"
            class="week-input"
          />
          <span class="week-range">{{ getWeekDateRange() }}</span>
        </div>
        <canvas id="weeklyBookingsChart"></canvas>
      </div>
    </mat-tab>

    <mat-tab label="Monthly Bookings">
      <div class="chart-wrapper">
        <div class="month-selector">
          <label for="monthPicker">Select Month:</label>
          <input
            id="monthPicker"
            type="month"
            [(ngModel)]="selectedMonth"
            (change)="onMonthChange()"
            class="month-input"
          />
          <span class="month-range">{{ getMonthDateRange() }}</span>
        </div>
        <canvas id="monthlyBookingsChart"></canvas>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
