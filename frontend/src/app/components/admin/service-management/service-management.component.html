<div class="service-management-container">
  <div class="service-header">
    <h2>Pricing Management</h2>
    <p>
      Manage vehicle types, service packages, and pricing matrix for your car
      wash business
    </p>
  </div>

  <div class="content-container">
    <div class="form-container">
      <div class="form-header">
        <h3>{{ editMode ? "Edit Pricing Entry" : "Add New Pricing Entry" }}</h3>
      </div>

      <div class="form-row">
        <div class="form-group half">
          <label for="vehicleType">Vehicle Type*</label>
          <select
            id="vehicleType"
            [(ngModel)]="newPricingEntry.vehicleType"
            required
          >
            <option value="" disabled selected>Select vehicle type</option>
            <option *ngFor="let vehicle of vehicleTypes" [value]="vehicle.code">
              {{ vehicle.code }} - {{ vehicle.description }}
            </option>
          </select>
        </div>

        <div class="form-group half">
          <label for="servicePackage">Service Package*</label>
          <select
            id="servicePackage"
            [(ngModel)]="newPricingEntry.servicePackage"
            required
          >
            <option value="" disabled selected>Select service package</option>
            <option
              *ngFor="let service of servicePackages"
              [value]="service.code"
            >
              {{ service.code }} - {{ service.description }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="price">Price (₱)*</label>
        <input
          type="number"
          id="price"
          [(ngModel)]="newPricingEntry.price"
          min="0"
          step="0.01"
          required
        />
      </div>

      <div class="form-group checkbox">
        <input
          type="checkbox"
          id="isActive"
          [(ngModel)]="newPricingEntry.isActive"
        />
        <label for="isActive">Active (available for booking)</label>
      </div>

      <div class="form-actions">
        <button
          *ngIf="!editMode"
          class="btn-primary"
          (click)="addPricingEntry()"
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">Add Pricing Entry</span>
          <span *ngIf="isLoading">Adding...</span>
        </button>
        <button
          *ngIf="editMode"
          class="btn-primary"
          (click)="updatePricingEntry()"
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">Update Pricing Entry</span>
          <span *ngIf="isLoading">Updating...</span>
        </button>
        <button
          *ngIf="editMode"
          class="btn-secondary"
          (click)="cancelEdit()"
          [disabled]="isLoading"
        >
          Cancel
        </button>
      </div>
    </div>

    <!-- Pricing Matrix Display -->
    <div class="pricing-matrix-container">
      <div class="matrix-header">
        <h3>Pricing Matrix</h3>
        <p>
          Current pricing structure for all vehicle types and service packages
        </p>
      </div>

      <div class="pricing-table">
        <table>
          <thead>
            <tr>
              <th>Vehicle Type</th>
              <th>P1</th>
              <th>P2</th>
              <th>P3</th>
              <th>P4</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let vehicle of vehicleTypes">
              <td class="vehicle-cell">
                <strong>{{ vehicle.code }}</strong>
                <div class="vehicle-desc">{{ vehicle.description }}</div>
              </td>
              <td *ngFor="let service of servicePackages" class="price-cell">
                <div class="price-amount">
                  ₱{{ pricingMatrix[vehicle.code][service.code] }}
                </div>
                <div class="price-actions">
                  <button
                    class="btn-icon edit"
                    (click)="
                      editPricingEntry({
                        vehicleType: vehicle.code,
                        servicePackage: service.code,
                        price: pricingMatrix[vehicle.code][service.code],
                        isActive: true
                      })
                    "
                    title="Edit Price"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Individual Pricing Entries List -->
    <div class="pricing-entries-list">
      <div class="list-header">
        <h3>Pricing Entries</h3>
        <div class="search-container">
          <input
            type="text"
            placeholder="Search pricing entries..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange($event)"
          />
        </div>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Vehicle Type</th>
              <th>Service Package</th>
              <th>Price</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let entry of filteredPricingEntries"
              [class.inactive]="!entry.isActive"
            >
              <td>{{ entry.id || "N/A" }}</td>
              <td>
                <strong>{{ entry.vehicleType }}</strong>
                <div class="entry-desc">
                  {{ getVehicleTypeDescription(entry.vehicleType) }}
                </div>
              </td>
              <td>
                <strong>{{ entry.servicePackage }}</strong>
                <div class="entry-desc">
                  {{ getServicePackageDescription(entry.servicePackage) }}
                </div>
              </td>
              <td class="price-display">₱{{ entry.price }}</td>
              <td>
                <span
                  class="status-badge"
                  [class.active]="entry.isActive"
                  [class.inactive]="!entry.isActive"
                >
                  {{ entry.isActive ? "Active" : "Inactive" }}
                </span>
              </td>
              <td class="actions-cell">
                <button
                  class="btn-icon edit"
                  (click)="editPricingEntry(entry)"
                  title="Edit"
                  [disabled]="isLoading"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  class="btn-icon toggle"
                  (click)="toggleStatus(entry)"
                  title="{{ entry.isActive ? 'Deactivate' : 'Activate' }}"
                  [disabled]="isLoading"
                >
                  <i
                    class="fas"
                    [class.fa-toggle-on]="entry.isActive"
                    [class.fa-toggle-off]="!entry.isActive"
                  ></i>
                </button>
                <button
                  class="btn-icon delete"
                  (click)="confirmDelete(entry.id || 0)"
                  title="Delete"
                  [disabled]="isLoading"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="isLoading">
              <td colspan="6" class="loading-data">
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                  Loading pricing entries...
                </div>
              </td>
            </tr>
            <tr
              *ngIf="
                !isLoading &&
                filteredPricingEntries.length === 0 &&
                pricingEntries.length > 0
              "
            >
              <td colspan="6" class="no-data">
                No pricing entries match your search criteria.
              </td>
            </tr>
            <tr *ngIf="!isLoading && pricingEntries.length === 0">
              <td colspan="6" class="no-data">
                No pricing entries found. Add your first pricing entry!
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Dialog -->
<div class="modal-overlay" *ngIf="showModal">
  <div class="modal-container" [ngClass]="modalType">
    <div class="modal-header">
      <h3 *ngIf="modalType === 'delete'">Confirm Delete</h3>
      <h3 *ngIf="modalType === 'success'">Success</h3>
      <h3 *ngIf="modalType === 'error'">Error</h3>
      <h3 *ngIf="modalType === 'warning'">Warning</h3>
      <h3 *ngIf="modalType === 'info'">Information</h3>
    </div>
    <div class="modal-body">
      <p>{{ modalMessage }}</p>
    </div>
    <div class="modal-footer">
      <button
        *ngIf="modalType === 'delete'"
        class="btn-danger"
        (click)="deletePricingEntry()"
        [disabled]="isLoading"
      >
        <span *ngIf="!isLoading">Delete</span>
        <span *ngIf="isLoading">Deleting...</span>
      </button>
      <button
        *ngIf="modalType === 'delete'"
        class="btn-secondary"
        (click)="closeModal()"
      >
        Cancel
      </button>
      <button
        *ngIf="modalType !== 'delete'"
        class="btn-primary"
        (click)="closeModal()"
      >
        OK
      </button>
    </div>
  </div>
</div>
