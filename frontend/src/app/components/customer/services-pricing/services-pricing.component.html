<div class="dashboard-container">
  <!-- Welcome Section -->
  <div class="welcome-section">
    <div class="welcome-header">
      <h1 class="welcome-title">Welcome, {{ customerName || "Customer" }}</h1>
    </div>
    <p class="welcome-description">
      View our comprehensive car wash service pricing based on your vehicle type
      and service package.
    </p>
    <button class="btn-primary" (click)="navigateToAppointment()">
      Book a Service Now
    </button>
  </div>

  <!-- Authentication Error Section -->
  <div
    *ngIf="
      (error && error.includes('authentication')) || error.includes('log in')
    "
    class="auth-error-section"
  >
    <div class="auth-error-content">
      <h2>Authentication Required</h2>
      <p>{{ error }}</p>
      <button class="btn-primary" (click)="redirectToLogin()">
        Log In Again
      </button>
    </div>
  </div>

  <!-- Services & Pricing Section -->
  <div
    *ngIf="!error || !error.includes('authentication')"
    class="services-section"
  >
    <div class="section-header">
      <h2>Service Packages & Pricing</h2>
      <p>Choose the perfect service package for your vehicle</p>
    </div>

    <!-- Service Packages Explanation -->
    <div class="packages-explanation">
      <h3>Service Package Details</h3>
      <div class="packages-grid">
        <div *ngFor="let package of servicePackages" class="package-info">
          <h4>Package {{ package.code }}</h4>
          <p>{{ package.description }}</p>
        </div>
      </div>
    </div>

    <!-- Vehicle Types Explanation -->
    <div class="vehicle-types-explanation">
      <h3>Vehicle Type Classification</h3>
      <div class="vehicle-types-grid">
        <div *ngFor="let vehicle of vehicleTypes" class="vehicle-info">
          <h4>{{ vehicle.code }}</h4>
          <p>{{ vehicle.description }}</p>
        </div>
      </div>
    </div>

    <!-- Pricing Matrix -->
    <div class="pricing-section">
      <h3>Pricing Matrix</h3>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Loading pricing information...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-state">
        <p class="error-message">{{ error }}</p>
        <button class="btn-primary" (click)="loadPricingData()">
          Try Again
        </button>
      </div>

      <!-- Pricing Table -->
      <div *ngIf="!loading && !error" class="pricing-table-container">
        <div class="pricing-table">
          <table>
            <thead>
              <tr>
                <th class="vehicle-header">Vehicle Type</th>
                <th
                  *ngFor="let package of servicePackages"
                  class="package-header"
                >
                  <div class="package-title">Package {{ package.code }}</div>
                  <div class="package-desc">{{ package.description }}</div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let vehicle of vehicleTypes" class="vehicle-row">
                <td class="vehicle-cell">
                  <div class="vehicle-code">{{ vehicle.code }}</div>
                  <div class="vehicle-desc">{{ vehicle.description }}</div>
                </td>
                <td *ngFor="let package of servicePackages" class="price-cell">
                  <div class="price-amount">
                    {{
                      formatPrice(
                        pricingMatrix[vehicle.code][package.code] || 0
                      )
                    }}
                  </div>
                  <button
                    class="btn-book-service"
                    (click)="
                      navigateToAppointmentWithPackage(
                        vehicle.code,
                        package.code
                      )
                    "
                    [disabled]="!isPriceAvailable(vehicle.code, package.code)"
                    [ngClass]="{
                      disabled: !isPriceAvailable(vehicle.code, package.code)
                    }"
                  >
                    {{
                      isPriceAvailable(vehicle.code, package.code)
                        ? "Book Now"
                        : "Unavailable"
                    }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Quick Booking Guide -->
      <div class="booking-guide">
        <h4 class="booking-title">How to Book</h4>
        <ol class="booking-steps">
          <li>Add a vehicle to your profile</li>
          <li>Identify your vehicle type from the classification above</li>
          <li>Choose your preferred service package</li>
          <li>Click "Book Now" for your selected combination</li>
          <li>Complete your appointment details</li>
        </ol>
      </div>
    </div>
  </div>
</div>
