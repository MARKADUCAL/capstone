<div class="transaction-history-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon">üìä</div>
      <div class="header-text">
        <h1>Transaction History</h1>
        <p>View and manage your car wash bookings</p>
      </div>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-number">{{ bookings.length }}</span>
        <span class="stat-label">Total Bookings</span>
      </div>
      <button
        class="refresh-btn"
        (click)="loadBookings()"
        [disabled]="isLoading"
      >
        <span class="refresh-icon">üîÑ</span>
        Refresh
      </button>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="filter-section">
    <div class="filter-tabs">
      <button
        class="filter-tab"
        [class.active]="currentFilter === 'all'"
        (click)="setFilter('all')"
      >
        <span class="tab-icon">üìã</span>
        <span class="tab-text">All</span>
        <span class="tab-count">{{ bookings.length }}</span>
      </button>
      <button
        class="filter-tab"
        [class.active]="currentFilter === 'pending'"
        (click)="setFilter('pending')"
      >
        <span class="tab-icon">‚è≥</span>
        <span class="tab-text">Pending</span>
        <span class="tab-count">{{ getFilterCount("pending") }}</span>
      </button>
      <button
        class="filter-tab"
        [class.active]="currentFilter === 'approved'"
        (click)="setFilter('approved')"
      >
        <span class="tab-icon">‚úÖ</span>
        <span class="tab-text">Approved</span>
        <span class="tab-count">{{ getFilterCount("approved") }}</span>
      </button>
      <button
        class="filter-tab"
        [class.active]="currentFilter === 'completed'"
        (click)="setFilter('completed')"
      >
        <span class="tab-icon">üéâ</span>
        <span class="tab-text">Completed</span>
        <span class="tab-count">{{ getFilterCount("completed") }}</span>
      </button>
      <button
        class="filter-tab"
        [class.active]="currentFilter === 'cancelled'"
        (click)="setFilter('cancelled')"
      >
        <span class="tab-icon">‚ùå</span>
        <span class="tab-text">Cancelled</span>
        <span class="tab-count">{{ getFilterCount("cancelled") }}</span>
      </button>
      <button
        class="filter-tab"
        [class.active]="currentFilter === 'rejected'"
        (click)="setFilter('rejected')"
      >
        <span class="tab-icon">üö´</span>
        <span class="tab-text">Declined</span>
        <span class="tab-count">{{ getFilterCount("rejected") }}</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading your transactions...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Oops! Something went wrong</h3>
    <p>{{ errorMessage }}</p>
    <button class="retry-btn" (click)="loadBookings()">
      <span class="retry-icon">üîÑ</span>
      Try Again
    </button>
  </div>

  <!-- Success State -->
  <div *ngIf="successMessage" class="success-container">
    <div class="success-icon">‚úÖ</div>
    <h3>Success!</h3>
    <p>{{ successMessage }}</p>
    <p class="success-note">
      Your booking list has been refreshed with the latest data.
    </p>
    <button class="close-btn" (click)="clearSuccessMessage()">
      <span class="close-icon">‚úï</span>
      Close
    </button>
  </div>

  <!-- Empty State -->
  <div
    *ngIf="!isLoading && !errorMessage && bookings.length === 0"
    class="empty-state"
  >
    <div class="empty-icon">üì≠</div>
    <h3>No Transactions Yet</h3>
    <p>
      You haven't made any car wash bookings yet. Book your first service to get
      started!
    </p>
    <button class="book-now-btn" (click)="navigateToBooking()">
      <span class="book-icon">üöó</span>
      Book Now
    </button>
  </div>

  <!-- No Filter Results -->
  <div
    *ngIf="
      !isLoading &&
      !errorMessage &&
      bookings.length > 0 &&
      filteredBookings.length === 0
    "
    class="empty-state"
  >
    <div class="empty-icon">üîç</div>
    <h3>No Results Found</h3>
    <p>
      No transactions match the current filter. Try selecting a different
      filter.
    </p>
  </div>

  <!-- Transaction Cards -->
  <div
    *ngIf="!isLoading && !errorMessage && filteredBookings.length > 0"
    class="transactions-grid"
  >
    <div
      class="transaction-card"
      *ngFor="let booking of filteredBookings; trackBy: trackByBooking"
    >
      <div class="card-header">
        <div class="booking-id">
          <span class="id-label">{{ getServiceName(booking) }}</span>
          <!-- Feedback indicator for completed bookings -->
          <div
            *ngIf="canSubmitFeedback(booking) && hasFeedback(booking)"
            class="feedback-indicator"
            title="Feedback submitted"
          >
            ‚úÖ Feedback Submitted
          </div>
        </div>
        <div
          class="status-badge"
          [ngClass]="'status-' + normalizeStatus(booking.status)"
        >
          <span class="status-icon">{{
            getStatusIcon(normalizeStatus(booking.status))
          }}</span>
          {{ displayStatus(booking.status) }}
        </div>
      </div>

      <div class="card-body">
        <div class="service-info">
          <div class="service-icon">üöø</div>
          <div class="service-details">
            <h4 class="service-name">{{ getServiceName(booking) }}</h4>
            <p class="service-description">
              {{ getServiceDescription(booking) }}
            </p>
          </div>
        </div>

        <div class="booking-details">
          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-icon">üìÖ</span>
              <span class="detail-label">Date</span>
              <span class="detail-value">{{
                formatDate(booking.washDate)
              }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">‚è∞</span>
              <span class="detail-label">Time</span>
              <span class="detail-value">{{
                formatTime(booking.washTime)
              }}</span>
            </div>
          </div>

          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-icon">üöó</span>
              <span class="detail-label">Vehicle</span>
              <span class="detail-value">{{
                booking.vehicleType || "Car"
              }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">üí≥</span>
              <span class="detail-label">Payment</span>
              <span class="detail-value">{{ booking.paymentType }}</span>
            </div>
          </div>

          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-icon">üë§</span>
              <span class="detail-label">Assigned To</span>
              <span
                class="detail-value"
                [ngClass]="{
                  'pending-assignment': !hasEmployeeAssigned(booking),
                  'assigned-employee': hasEmployeeAssigned(booking)
                }"
              >
                {{ getEmployeeInfo(booking) }}
              </span>
            </div>
          </div>
        </div>

        <div class="price-section">
          <div class="price-amount">
            <span class="currency">‚Ç±</span>
            <span class="amount">{{ booking.price }}</span>
          </div>
          <span class="price-label">Total Amount</span>
        </div>

        <!-- Decline Reason Section (only for rejected bookings) -->
        <div
          class="rejection-section"
          *ngIf="
            normalizeStatus(booking.status) === 'rejected' &&
            getRejectionReason(booking)
          "
        >
          <div class="rejection-header">
            <span class="rejection-icon">üö´</span>
            <span class="rejection-title">Decline Reason</span>
          </div>
          <div class="rejection-content">
            {{ getRejectionReason(booking) }}
          </div>
        </div>

        <!-- Admin Comment Section (if admin replied to feedback) -->
        <div
          class="admin-comment"
          *ngIf="
            $any(booking).adminComment &&
            $any(booking).adminComment.trim().length > 0
          "
        >
          <div class="admin-comment-header">
            <span class="admin-icon">üõ†Ô∏è</span>
            <span class="admin-title">Admin Reply</span>
            <span class="admin-time" *ngIf="$any(booking).adminCommentedAt">
              {{
                $any(booking).adminCommentedAt | date : "MMM dd, yyyy, h:mm a"
              }}
            </span>
          </div>
          <div class="admin-comment-content">
            {{ $any(booking).adminComment }}
          </div>
        </div>
      </div>

      <div class="card-actions">
        <button class="action-btn view-btn" (click)="openViewModal(booking)">
          <span class="btn-icon">üëÅÔ∏è</span>
          View Details
        </button>
        <button
          *ngIf="canCancelBooking(booking)"
          class="action-btn cancel-btn"
          (click)="openCancelModal(booking)"
        >
          <span class="btn-icon">‚ùå</span>
          Cancel Booking
        </button>
        <button
          *ngIf="canSubmitFeedback(booking)"
          class="action-btn feedback-btn"
          (click)="openFeedbackModal(booking)"
          [disabled]="hasFeedback(booking)"
          [title]="
            hasFeedback(booking)
              ? 'You have already submitted feedback for this booking'
              : 'Click to leave feedback for this completed service'
          "
        >
          <span class="btn-icon">{{ hasFeedback(booking) ? "‚úÖ" : "üí¨" }}</span>
          {{ hasFeedback(booking) ? "Feedback Submitted" : "Leave Feedback" }}
        </button>
        <div *ngIf="!canSubmitFeedback(booking)" class="feedback-disabled">
          <span class="feedback-icon">‚è≥</span>
          <span class="feedback-text">Complete to leave feedback</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced View Transaction Modal -->
<div
  class="modal-overlay"
  [class.show]="isViewModalOpen"
  (click)="closeViewModal()"
>
  <div
    class="modal-container"
    (click)="$event.stopPropagation()"
    *ngIf="selectedBooking"
  >
    <div class="modal-header">
      <div class="modal-title">
        <h2>Transaction Details</h2>
        <span class="transaction-id">{{
          getServiceName(selectedBooking)
        }}</span>
      </div>
      <button class="close-btn" (click)="closeViewModal()">
        <span class="close-icon">‚úï</span>
      </button>
    </div>

    <div class="modal-body">
      <div
        class="status-banner"
        [ngClass]="'status-' + normalizeStatus(selectedBooking.status)"
      >
        <div class="status-content">
          <span class="status-icon-large">{{
            getStatusIcon(normalizeStatus(selectedBooking.status))
          }}</span>
          <div class="status-info">
            <h3>{{ displayStatus(selectedBooking.status) }}</h3>
            <p>
              {{
                getStatusDescription(normalizeStatus(selectedBooking.status))
              }}
            </p>
          </div>
        </div>
      </div>

      <div class="details-grid">
        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-icon">üìÖ</span>
            <h4>Booking Information</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Date:</span>
              <span class="value">{{
                formatDate(selectedBooking.washDate)
              }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Time:</span>
              <span class="value">{{
                formatTime(selectedBooking.washTime)
              }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Vehicle Type:</span>
              <span class="value">{{
                selectedBooking.vehicleType || "Car"
              }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Plate Number:</span>
              <span class="value">{{
                selectedBooking.plateNumber || $any(selectedBooking).plate_number || "N/A"
              }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Vehicle Model:</span>
              <span class="value">{{
                selectedBooking.vehicleModel || $any(selectedBooking).vehicle_model || "N/A"
              }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Vehicle Color:</span>
              <span class="value">{{
                selectedBooking.vehicleColor || $any(selectedBooking).vehicle_color || "N/A"
              }}</span>
            </div>
          </div>
        </div>

        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-icon">üöø</span>
            <h4>Service Details</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Service:</span>
              <span class="value">{{ getPackageLabel(selectedBooking) }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Label of the package:</span>
              <span class="value">{{ getServiceName(selectedBooking) }}</span>
            </div>
          </div>
        </div>

        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-icon">üë§</span>
            <h4>Employee Assignment</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Assigned To:</span>
              <span
                class="value"
                [ngClass]="{
                  'pending-assignment': !hasEmployeeAssigned(selectedBooking),
                  'assigned-employee': hasEmployeeAssigned(selectedBooking)
                }"
              >
                {{ getEmployeeInfo(selectedBooking) }}
              </span>
            </div>
            <div
              class="detail-row"
              *ngIf="
                hasEmployeeAssigned(selectedBooking) &&
                normalizeStatus(selectedBooking.status) !== 'completed'
              "
            >
              <span class="label">Employee ID:</span>
              <span class="value">{{
                selectedBooking.assigned_employee_id
              }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="
                hasEmployeeAssigned(selectedBooking) &&
                $any(selectedBooking).employee_phone
              "
            >
              <span class="label">Contact:</span>
              <span class="value">{{
                $any(selectedBooking).employee_phone
              }}</span>
            </div>
          </div>
        </div>

        <!-- Customer Rating Section (if available) -->
        <div class="detail-card" *ngIf="getCustomerRating(selectedBooking)">
          <div class="detail-header">
            <span class="detail-icon">‚≠ê</span>
            <h4>Customer Rating</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Rating:</span>
              <span class="value rating-display">
                <div class="star-rating-display">
                  <span class="stars">{{
                    getStarDisplay(getCustomerRating(selectedBooking) || 0)
                  }}</span>
                  <span class="rating-value"
                    >{{ getCustomerRating(selectedBooking) }}/5</span
                  >
                </div>
              </span>
            </div>
            <div
              class="detail-row"
              *ngIf="getCustomerRatingLabel(selectedBooking)"
            >
              <span class="label">Feedback Summary:</span>
              <span class="value">{{
                getCustomerRatingLabel(selectedBooking)
              }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="getCustomerRatingComment(selectedBooking)"
            >
              <span class="label">Comment:</span>
              <span class="value rating-comment">{{
                getCustomerRatingComment(selectedBooking)
              }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="$any(selectedBooking).feedbackCustomerName"
            >
              <span class="label">Submitted By:</span>
              <span class="value">{{
                $any(selectedBooking).feedbackCustomerName
              }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="$any(selectedBooking).feedbackCreatedAt"
            >
              <span class="label">Submitted On:</span>
              <span class="value">{{
                $any(selectedBooking).feedbackCreatedAt
                  | date : "MMM dd, yyyy 'at' h:mm a"
              }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="getFeedbackVisibility(selectedBooking)"
            >
              <span class="label">Visibility:</span>
              <span class="value">{{
                getFeedbackVisibility(selectedBooking)
              }}</span>
            </div>
          </div>
        </div>

        <!-- Admin Reply Section (if admin replied to feedback) -->
        <div
          class="detail-card"
          *ngIf="
            $any(selectedBooking).adminComment &&
            $any(selectedBooking).adminComment.trim().length > 0
          "
        >
          <div class="detail-header">
            <span class="detail-icon">üõ†Ô∏è</span>
            <h4>Admin Reply</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Reply:</span>
              <span class="value admin-reply-text">{{
                $any(selectedBooking).adminComment
              }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="$any(selectedBooking).adminCommentedAt"
            >
              <span class="label">Replied On:</span>
              <span class="value">{{
                $any(selectedBooking).adminCommentedAt
                  | date : "MMM dd, yyyy 'at' h:mm a"
              }}</span>
            </div>
          </div>
        </div>

        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-icon">üí≥</span>
            <h4>Payment Information</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Amount:</span>
              <span class="value price"
                >‚Ç±{{ selectedBooking.price | number : "1.2-2" }}</span
              >
            </div>
            <div class="detail-row">
              <span class="label">Method:</span>
              <span class="value">{{ selectedBooking.paymentType }}</span>
            </div>
            <div class="detail-row" *ngIf="$any(selectedBooking).paymentStatus">
              <span class="label">Payment Status:</span>
              <span
                class="value"
                [ngClass]="
                  'payment-' + $any(selectedBooking).paymentStatus.toLowerCase()
                "
              >
                {{ $any(selectedBooking).paymentStatus }}
              </span>
            </div>
            <div class="detail-row" *ngIf="$any(selectedBooking).transactionId">
              <span class="label">Transaction ID:</span>
              <span class="value">{{
                $any(selectedBooking).transactionId
              }}</span>
            </div>
          </div>
        </div>

        <!-- Additional Booking Information -->
        <div class="detail-card" *ngIf="hasAdditionalInfo(selectedBooking)">
          <div class="detail-header">
            <span class="detail-icon">üìã</span>
            <h4>Additional Information</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row" *ngIf="getBookingNotes(selectedBooking)">
              <span class="label">Notes:</span>
              <span class="value">{{ getBookingNotes(selectedBooking) }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="$any(selectedBooking).specialRequests"
            >
              <span class="label">Special Requests:</span>
              <span class="value">{{
                $any(selectedBooking).specialRequests
              }}</span>
            </div>
            <div class="detail-row" *ngIf="$any(selectedBooking).bookingSource">
              <span class="label">Booking Source:</span>
              <span class="value">{{
                $any(selectedBooking).bookingSource
              }}</span>
            </div>
            <div
              class="detail-row"
              *ngIf="$any(selectedBooking).estimatedDuration"
            >
              <span class="label">Estimated Duration:</span>
              <span class="value"
                >{{ $any(selectedBooking).estimatedDuration }} minutes</span
              >
            </div>
          </div>
        </div>

        <!-- Service Timeline -->
        <div class="detail-card" *ngIf="hasServiceTimeline(selectedBooking)">
          <div class="detail-header">
            <span class="detail-icon">‚è±Ô∏è</span>
            <h4>Service Timeline</h4>
          </div>
          <div class="detail-content">
            <div
              class="detail-row"
              *ngIf="$any(selectedBooking).bookingCreatedAt"
            >
              <span class="label">Booked:</span>
              <span class="value">{{
                $any(selectedBooking).bookingCreatedAt
                  | date : "MMM dd, yyyy 'at' h:mm a"
              }}</span>
            </div>
            <div class="detail-row" *ngIf="$any(selectedBooking).approvedAt">
              <span class="label">Approved:</span>
              <span class="value">{{
                $any(selectedBooking).approvedAt
                  | date : "MMM dd, yyyy 'at' h:mm a"
              }}</span>
            </div>
            <div class="detail-row" *ngIf="$any(selectedBooking).startedAt">
              <span class="label">Started:</span>
              <span class="value">{{
                $any(selectedBooking).startedAt
                  | date : "MMM dd, yyyy 'at' h:mm a"
              }}</span>
            </div>
            <div class="detail-row" *ngIf="$any(selectedBooking).completedAt">
              <span class="label">Completed:</span>
              <span class="value">{{
                $any(selectedBooking).completedAt
                  | date : "MMM dd, yyyy 'at' h:mm a"
              }}</span>
            </div>
          </div>
        </div>

        <!-- Decline Reason Card (only for rejected bookings) -->
        <div
          class="detail-card rejection-card"
          *ngIf="
            normalizeStatus(selectedBooking.status) === 'rejected' &&
            getRejectionReason(selectedBooking)
          "
        >
          <div class="detail-header">
            <span class="detail-icon">üö´</span>
            <h4>Decline Information</h4>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Reason:</span>
              <span class="value rejection-reason">{{
                getRejectionReason(selectedBooking)
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="modal-btn secondary" (click)="closeViewModal()">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Enhanced Feedback Modal -->
<div
  class="modal-overlay"
  [class.show]="isFeedbackModalOpen"
  (click)="closeFeedbackModal()"
>
  <div
    class="modal-container feedback-modal"
    (click)="$event.stopPropagation()"
  >
    <div class="modal-header">
      <div class="modal-title">
        <h2>Share Your Experience</h2>
        <p>We'd love to hear about your car wash service</p>
      </div>
      <button class="close-btn" (click)="closeFeedbackModal()">
        <span class="close-icon">‚úï</span>
      </button>
    </div>

    <div class="modal-body">
      <div class="detail-card feedback-context-card" *ngIf="selectedBooking">
        <div class="detail-header">
          <span class="detail-icon">üßæ</span>
          <h4>Booking Summary</h4>
        </div>
        <div class="detail-content">
          <div class="detail-row">
            <span class="label">Service:</span>
            <span class="value">{{ getServiceName(selectedBooking) }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Description:</span>
            <span class="value">{{
              getServiceDescription(selectedBooking)
            }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Schedule:</span>
            <span class="value"
              >{{ formatDate(selectedBooking.washDate) }} ‚Ä¢
              {{ formatTime(selectedBooking.washTime) }}</span
            >
          </div>
          <div class="detail-row" *ngIf="selectedBooking.price">
            <span class="label">Amount Paid:</span>
            <span class="value">‚Ç±{{ selectedBooking.price }}</span>
          </div>
        </div>
      </div>

      <div class="rating-section">
        <h3>How would you rate our service?</h3>
        <div class="star-rating">
          <button
            class="star-btn"
            *ngFor="let star of [1, 2, 3, 4, 5]"
            [class.active]="star <= currentRating"
            (click)="setRating(star)"
          >
            <span class="star-icon">‚òÖ</span>
          </button>
        </div>
        <p class="rating-text">{{ getRatingText() }}</p>
        <ul class="rating-guidelines">
          <li>
            <strong>5 stars</strong> ‚Äì Exceptional experience, highly satisfied.
          </li>
          <li>
            <strong>4 stars</strong> ‚Äì Great service with minor areas for
            improvement.
          </li>
          <li>
            <strong>3 stars</strong> ‚Äì Average experience, met basic
            expectations.
          </li>
          <li>
            <strong>2 stars</strong> ‚Äì Below expectations, several issues
            encountered.
          </li>
          <li>
            <strong>1 star</strong> ‚Äì Very unsatisfied, major problems with the
            service.
          </li>
        </ul>
      </div>

      <div class="feedback-section">
        <label for="feedback-text">Tell us more about your experience:</label>
        <textarea
          id="feedback-text"
          [(ngModel)]="feedbackComment"
          placeholder="Share your thoughts, suggestions, or any issues you encountered..."
          rows="4"
          class="feedback-textarea"
        ></textarea>
      </div>

      <!-- Feedback Messages -->
      <div *ngIf="feedbackSuccessMessage" class="feedback-success">
        <div class="success-icon">‚úÖ</div>
        <p>{{ feedbackSuccessMessage }}</p>
      </div>

      <div *ngIf="feedbackErrorMessage" class="feedback-error">
        <div class="error-icon">‚ö†Ô∏è</div>
        <p>{{ feedbackErrorMessage }}</p>
        <button class="clear-btn" (click)="clearFeedbackMessages()">
          Clear
        </button>
      </div>
    </div>

    <div class="modal-footer">
      <button class="modal-btn secondary" (click)="closeFeedbackModal()">
        Cancel
      </button>
      <button
        class="modal-btn primary submit-btn"
        [disabled]="currentRating === 0 || isSubmittingFeedback"
        (click)="submitFeedback()"
      >
        <span class="btn-icon" *ngIf="!isSubmittingFeedback">üì§</span>
        <span class="btn-icon" *ngIf="isSubmittingFeedback">‚è≥</span>
        {{ isSubmittingFeedback ? "Submitting..." : "Submit Feedback" }}
      </button>
    </div>
  </div>
</div>

<!-- Cancel Booking Confirmation Modal -->
<div
  class="modal-overlay"
  [class.show]="isCancelModalOpen"
  (click)="closeCancelModal()"
>
  <div
    class="modal-container cancel-modal"
    (click)="$event.stopPropagation()"
    *ngIf="bookingToCancel"
  >
    <div class="modal-header">
      <div class="modal-title">
        <h2>Cancel Booking</h2>
        <p>Are you sure you want to cancel this booking?</p>
      </div>
      <button class="close-btn" (click)="closeCancelModal()">
        <span class="close-icon">‚úï</span>
      </button>
    </div>

    <div class="modal-body">
      <div class="cancel-warning">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h3>This action cannot be undone</h3>
        <p>
          Once cancelled, this booking will be permanently removed from your
          transaction history.
        </p>
      </div>

      <div class="booking-summary">
        <h4>Booking Details:</h4>
        <div class="summary-item">
          <span class="label">Service:</span>
          <span class="value">{{ getServiceName(bookingToCancel) }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Date:</span>
          <span class="value">{{ formatDate(bookingToCancel.washDate) }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Time:</span>
          <span class="value">{{ formatTime(bookingToCancel.washTime) }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Amount:</span>
          <span class="value">‚Ç± {{ bookingToCancel.price }}</span>
        </div>
      </div>

      <!-- Reason for cancellation -->
      <div class="cancel-reason">
        <h4>Reason for cancelling (optional)</h4>
        <textarea
          [(ngModel)]="cancelReason"
          placeholder="E.g., Change of plans, not available at this time"
          rows="3"
          class="cancel-reason-textarea"
        ></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button
        class="modal-btn secondary"
        (click)="closeCancelModal()"
        [disabled]="isCancelling"
      >
        Keep Booking
      </button>
      <button
        class="modal-btn danger"
        (click)="cancelBooking()"
        [disabled]="isCancelling"
      >
        <span class="btn-icon" *ngIf="!isCancelling">‚ùå</span>
        <span class="btn-icon" *ngIf="isCancelling">‚è≥</span>
        {{ isCancelling ? "Cancelling..." : "Cancel Booking" }}
      </button>
    </div>
  </div>
</div>
