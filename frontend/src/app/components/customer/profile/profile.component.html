<div class="profile-container">
  <div class="profile-header">
    <h2>Customer Profile</h2>
    <div class="action-buttons" *ngIf="!isEditing">
      <button class="edit-button" (click)="toggleEdit()">Edit Profile</button>
    </div>
  </div>

  <div class="alert success" *ngIf="successMessage">
    {{ successMessage }}
  </div>

  <div class="alert error" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <div class="profile-content">
    <!-- View Mode -->
    <div class="profile-info" *ngIf="!isEditing">
      <div class="avatar-container">
        <div class="avatar-placeholder">
          {{ profile.first_name.charAt(0) }}{{ profile.last_name.charAt(0) }}
        </div>
      </div>

      <div class="profile-details">
        <div class="info-group">
          <label>First Name:</label>
          <span>{{ profile.first_name }}</span>
        </div>

        <div class="info-group">
          <label>Last Name:</label>
          <span>{{ profile.last_name }}</span>
        </div>

        <div class="info-group">
          <label>Email:</label>
          <span>{{ profile.email }}</span>
        </div>

        <div class="info-group">
          <label>Phone:</label>
          <span>{{ profile.phone || "Not provided" }}</span>
        </div>

        <div class="info-group">
          <label>Membership:</label>
          <span><span class="membership-status">Active Customer</span></span>
        </div>

        <div class="info-group">
          <label>Account Type:</label>
          <span>Customer</span>
        </div>
      </div>
    </div>

    <!-- Edit Mode -->
    <form *ngIf="isEditing" (ngSubmit)="saveProfile()">
      <div class="form-section">
        <h3>Personal Information</h3>

        <div class="form-group">
          <label for="firstName">First Name</label>
          <input
            type="text"
            id="firstName"
            name="firstName"
            [(ngModel)]="profile.first_name"
            required
          />
        </div>

        <div class="form-group">
          <label for="lastName">Last Name</label>
          <input
            type="text"
            id="lastName"
            name="lastName"
            [(ngModel)]="profile.last_name"
            required
          />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="profile.email"
            required
            disabled
          />
        </div>

        <div class="form-group">
          <label for="phone">Phone</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            [(ngModel)]="profile.phone"
          />
        </div>
      </div>

      <div class="form-section">
        <h3>Change Password <span class="optional">(Optional)</span></h3>

        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input
            type="password"
            id="currentPassword"
            name="currentPassword"
            [(ngModel)]="currentPassword"
          />
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input
            type="password"
            id="newPassword"
            name="newPassword"
            [(ngModel)]="newPassword"
          />
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
          />
        </div>
      </div>

      <div class="form-actions">
        <button
          type="button"
          class="cancel-button"
          (click)="cancelEdit()"
          [disabled]="isSaving"
        >
          Cancel
        </button>
        <button type="submit" class="save-button" [disabled]="isSaving">
          {{ isSaving ? "Saving..." : "Save Changes" }}
        </button>
      </div>
    </form>
  </div>

  <div class="vehicle-section">
    <div class="vehicle-section-header">
      <div>
        <h3>Saved Vehicles</h3>
        <p>Store your car details for faster bookings.</p>
      </div>
      <div class="vehicle-section-actions">
        <button
          type="button"
          class="add-vehicle-button"
          *ngIf="!isAddingVehicle"
          (click)="startAddVehicle()"
        >
          + Add Vehicle
        </button>
        <button
          type="button"
          class="cancel-vehicle-button"
          *ngIf="isAddingVehicle"
          (click)="cancelAddVehicle()"
        >
          Close Form
        </button>
      </div>
    </div>

    <div class="alert success" *ngIf="vehicleSuccessMessage">
      {{ vehicleSuccessMessage }}
    </div>

    <div class="alert error" *ngIf="vehicleErrorMessage">
      {{ vehicleErrorMessage }}
    </div>

    <div class="vehicle-grid" *ngIf="customerVehicles.length > 0">
      <div class="vehicle-card" *ngFor="let vehicle of customerVehicles">
        <div class="vehicle-card-header">
          <div>
            <h4>{{ vehicle.nickname || vehicle.vehicle_model }}</h4>
            <span class="vehicle-type-label">{{ vehicle.vehicle_type }}</span>
          </div>
          <button
            type="button"
            class="remove-vehicle-button"
            (click)="removeVehicle(vehicle.id)"
          >
            Remove
          </button>
        </div>
        <div class="vehicle-card-body">
          <div class="vehicle-info-row">
            <span>Model</span>
            <strong>{{ vehicle.vehicle_model }}</strong>
          </div>
          <div class="vehicle-info-row">
            <span>Plate Number</span>
            <strong>{{ vehicle.plate_number }}</strong>
          </div>
          <div class="vehicle-info-row">
            <span>Color</span>
            <strong>{{ vehicle.vehicle_color || "Not set" }}</strong>
          </div>
          <div class="vehicle-info-row">
            <span>Added</span>
            <strong>{{ vehicle.created_at | date : "mediumDate" }}</strong>
          </div>
        </div>
      </div>
    </div>

    <div class="vehicle-empty-state" *ngIf="customerVehicles.length === 0">
      <p>You haven't saved any vehicles yet.</p>
      <small>Add your car to speed up booking forms later.</small>
    </div>

    <form
      class="vehicle-form"
      *ngIf="isAddingVehicle"
      (ngSubmit)="addVehicle()"
    >
      <div class="vehicle-form-grid">
        <div class="form-group">
          <label for="vehicleType">Vehicle Type</label>
          <select
            id="vehicleType"
            name="vehicleType"
            [(ngModel)]="newVehicle.vehicleType"
            required
          >
            <option value="" disabled>Select vehicle type</option>
            <option *ngFor="let type of vehicleTypes" [value]="type">
              {{ type }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="vehicleModel">Vehicle Model</label>
          <input
            type="text"
            id="vehicleModel"
            name="vehicleModel"
            [(ngModel)]="newVehicle.vehicleModel"
            required
          />
        </div>

        <div class="form-group">
          <label for="plateNumber">Plate Number</label>
          <input
            type="text"
            id="plateNumber"
            name="plateNumber"
            [(ngModel)]="newVehicle.plateNumber"
            required
          />
        </div>

        <div class="form-group">
          <label for="vehicleColor"
            >Vehicle Color <span class="optional">(Optional)</span></label
          >
          <input
            type="text"
            id="vehicleColor"
            name="vehicleColor"
            [(ngModel)]="newVehicle.vehicleColor"
          />
        </div>

        <div class="form-group">
          <label for="nickname"
            >Nickname <span class="optional">(Optional)</span></label
          >
          <input
            type="text"
            id="nickname"
            name="nickname"
            [(ngModel)]="newVehicle.nickname"
            placeholder="e.g. Family SUV"
          />
        </div>
      </div>

      <div class="vehicle-form-actions">
        <button
          type="button"
          class="cancel-button ghost"
          (click)="cancelAddVehicle()"
        >
          Cancel
        </button>
        <button type="submit" class="save-button">Save Vehicle</button>
      </div>
    </form>
  </div>
</div>
